name: CI Workflow - Assignment Validation

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate-assignment:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: List all files in repository
      run: |
        echo "=== Repository Contents ==="
        ls -la
        echo ""
    
    - name: Check for required text files
      run: |
        echo "=== Checking for Required Files ==="
        echo "Looking for pattern: *_gb.txt, *_devops.txt, *_sdlc.txt"
        echo ""
        
        # Count each type of file
        GB_COUNT=$(ls *_gb.txt 2>/dev/null | wc -l)
        DEVOPS_COUNT=$(ls *_devops.txt 2>/dev/null | wc -l)
        SDLC_COUNT=$(ls *_sdlc.txt 2>/dev/null | wc -l)
        
        echo "Found $GB_COUNT George Brown file(s)"
        echo "Found $DEVOPS_COUNT DevOps file(s)"
        echo "Found $SDLC_COUNT SDLC file(s)"
        echo ""
        
        # Display found files
        if [ $GB_COUNT -gt 0 ]; then
          echo "George Brown files:"
          ls *_gb.txt
          echo ""
        fi
        
        if [ $DEVOPS_COUNT -gt 0 ]; then
          echo "DevOps files:"
          ls *_devops.txt
          echo ""
        fi
        
        if [ $SDLC_COUNT -gt 0 ]; then
          echo "SDLC files:"
          ls *_sdlc.txt
          echo ""
        fi
        
        # Validation
        TOTAL_FILES=$((GB_COUNT + DEVOPS_COUNT + SDLC_COUNT))
        
        if [ $GB_COUNT -eq 0 ] || [ $DEVOPS_COUNT -eq 0 ] || [ $SDLC_COUNT -eq 0 ]; then
          echo "❌ ERROR: Missing required file types!"
          echo "Each team member must have all 3 files:"
          echo "  - STUDENTID_gb.txt"
          echo "  - STUDENTID_devops.txt"
          echo "  - STUDENTID_sdlc.txt"
          exit 1
        fi
        
        echo "✅ SUCCESS: All required file types are present!"
        echo "Total files found: $TOTAL_FILES"
    
    - name: Verify file content (not empty)
      run: |
        echo "=== Verifying File Content ==="
        EMPTY_FILES=0
        
        for file in *_gb.txt *_devops.txt *_sdlc.txt; do
          if [ -f "$file" ]; then
            SIZE=$(wc -c < "$file")
            if [ $SIZE -eq 0 ]; then
              echo "⚠️  WARNING: $file is empty!"
              EMPTY_FILES=$((EMPTY_FILES + 1))
            else
              echo "✓ $file has content ($SIZE bytes)"
            fi
          fi
        done
        
        echo ""
        if [ $EMPTY_FILES -gt 0 ]; then
          echo "❌ ERROR: $EMPTY_FILES file(s) are empty!"
          echo "All files must contain content about the required topics."
          exit 1
        fi
        
        echo "✅ All files have content!"
    
    - name: Check README exists
      run: |
        echo "=== Checking for README ==="
        if [ -f "README.md" ]; then
          echo "✅ README.md found"
        else
          echo "⚠️  WARNING: README.md not found"
          echo "Assignment requires updating README.md with group details"
        fi
    
    - name: Summary
      run: |
        echo ""
        echo "======================================"
        echo "       VALIDATION COMPLETE ✅"
        echo "======================================"
        echo "All required assignment files are present and valid!"
